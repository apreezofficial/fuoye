# Gemini AI Setup Guide

## Overview
The CBT system uses Google Gemini AI to generate unique questions for each exam attempt. This ensures every student gets different questions, making the system more secure and fair.

## Setup Instructions

### 1. Get Gemini API Key
1. Visit [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Sign in with your Google account
3. Click "Create API Key"
4. Copy your API key

### 2. Configure API Key

**Option A: Environment Variable (Recommended for Production)**
```bash
# Set environment variable
export GEMINI_API_KEY="your-api-key-here"
```

**Option B: Config File (Development)**
Edit `backend/config/gemini.php`:
```php
return [
    'api_key' => 'your-api-key-here',
];
```

### 3. Database Setup
Run the questions schema migration:
```sql
-- Run this SQL in your database
CREATE TABLE IF NOT EXISTS exam_questions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    attempt_id INT NOT NULL,
    question_text TEXT NOT NULL,
    options JSON NOT NULL,
    correct_answer_index INT NOT NULL,
    question_order INT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (attempt_id) REFERENCES exam_attempts(id) ON DELETE CASCADE,
    INDEX idx_attempt_id (attempt_id),
    INDEX idx_question_order (attempt_id, question_order)
);
```

Or run the provided SQL file:
```bash
mysql -u root -p fuoye_smart_campus < backend/database/questions_schema.sql
```

## How It Works

1. **Question Generation**: When a student starts an exam, the system calls Gemini AI with:
   - Course title and code
   - Number of questions needed
   - Academic level (100, 200, 300, 400)

2. **Unique Questions**: Each exam attempt gets a fresh set of questions generated by AI

3. **Storage**: Questions are stored in the `exam_questions` table linked to the specific attempt

4. **Fallback**: If Gemini API is unavailable, the system uses fallback questions (basic templates)

## API Usage Limits

- Free tier: 60 requests per minute
- For production, consider implementing caching or question pools

## Troubleshooting

**Error: "API key not found"**
- Ensure the API key is set in environment variable or config file
- Check file permissions on `backend/config/gemini.php`

**Error: "Rate limit exceeded"**
- You've exceeded the free tier limits
- Consider implementing request queuing or caching

**Questions not generating**
- Check PHP error logs
- Verify API key is valid
- Ensure cURL is enabled in PHP
- Check network connectivity

## Security Notes

- Never commit API keys to version control
- Use environment variables in production
- Rotate API keys regularly
- Monitor API usage for unusual patterns


